# ------------------------------------------------------------
# branch_hospital.rpy
# Ветка Больницы (расширенная) — "перепрошивка интерпретации"
# Открывает концовку Hospital только при 3/3 правильных выборах
# Добавлено: трудности, сюжетный поворот, "двойная интерпретация"
# ------------------------------------------------------------

label branch_hospital:

    # локальный счётчик правильных выборов
    $ hospital_score = 0

    # локальный флаг поворота (не обязателен, но пригодится для актов дальше)
    $ hospital_twist_seen = False

    scene hospital_room
    with fade

    play music "audio/ambient_hospital.ogg" fadein 1.5

    oliver "Белый свет."
    oliver "Слишком реальный."

    hamayumi "Это пробой."
    hamayumi "Если ты примешь его — киберспейс отступит."

    oliver "Если это всё симптом…"
    oliver "Тогда я могу остановить это."

    hamayumi "Ты уверен, что хочешь, чтобы тебя 'починили'?"
    hamayumi "Иногда чинят не боль — а память о ней."

    # -------------------------
    # Экран 2 — Кабинет врача
    # -------------------------
    scene hospital_office
    with dissolve

    show doctor at center
    with dissolve

    doctor "Салатик Оливер."
    doctor "Расскажите, что вы видите."
    doctor "Без художественных деталей. Только факты."

    hamayumi "Слышишь?"
    hamayumi "Факты — это форма контроля."
    hamayumi "Но иногда она спасает."

    menu:
        "Ответ врачу"

        "Это фантазии. Просто шум.":
            doctor "Хорошо."
            doctor "Мы назовём это и перестанем подпитывать."
            hamayumi "Иногда название — это клетка."
            hamayumi "Если ты назвал — тебя можно отучать."

        "Я видел Quins.":
            doctor "Мы разберём это позже."
            doctor "Сначала закрепим реальность."
            hamayumi "Ты спрятал смысл в имени."
            hamayumi "Имя удобно: его можно объявить симптомом."

        "Я видел город.":
            doctor "Это реакция на стресс."
            doctor "Мозг достраивает среду, чтобы выдержать нагрузку."
            hamayumi "И всё же город реагирует на тебя."
            hamayumi "Симптомы не задают вопросов."

        "Я не уверен. Но это влияет на выбор.":
            $ hospital_score += 1
            doctor "Это честный ответ."
            doctor "Сомнение — не провал. Это наблюдение."
            hamayumi "Честность держит тебя целым."

    doctor "Мы попробуем простую штуку."
    doctor "Я дам вам 'якорь'."
    doctor "Если начнёт уносить — держитесь за него."

    doctor "Скажите: какая сегодня дата?"

    menu:
        "Якорь"

        "Я не помню. Но я могу проверить.":
            $ hospital_score += 1
            doctor "Правильно."
            doctor "Не фантазировать. Проверять."
            hamayumi "Проверка — это выбор, который не зависит от страха."

        "Любая. Здесь время не важно.":
            doctor "Для вас — важно."
            doctor "Это основа ориентации."
            hamayumi "Он ставит рамку."
            hamayumi "Рамки помогают. И ломают."

        "Сегодня... (назвать любую)":
            doctor "Хорошо."
            doctor "Но мы это зафиксируем по карте."
            hamayumi "Удобно."
            hamayumi "Когда за тебя фиксируют — ты перестаёшь держать сам."

    doctor "Ещё вопрос."
    doctor "Кто такой Хамаюми?"

    menu:
        "О Хамаюми"

        "Это мой внутренний голос, и он меня удерживает.":
            $ hospital_score += 1
            doctor "Понял."
            doctor "Мы не будем спорить с ним."
            doctor "Мы научимся проверять его."
            hamayumi "Он не пытается меня убить."
            hamayumi "Он пытается поставить мне правила."

        "Его нет.":
            doctor "Хорошо."
            doctor "Тогда вам будет проще."
            hamayumi "Ложь ради простоты."
            hamayumi "Так начинаются удобные исчезновения."

        "Это часть киберпространства.":
            doctor "Тогда тем более нужно якорение."
            hamayumi "И тем более тебе страшно признать, что я — часть тебя."

    hide doctor
    with dissolve

    # -------------------------
    # Экран 3 — Палата: трудность/ломка привычки
    # -------------------------
    scene hospital_room
    with dissolve

    hamayumi "Ты стираешь меня словами."
    hamayumi "Но пока не до конца."

    oliver "Тогда почему ты всё ещё здесь?"

    hamayumi "Потому что ты не просто веришь."
    hamayumi "Ты привык."
    hamayumi "А привычка сильнее аргументов."

    "Тишина" "Пииии—"
    "Тишина" "Пииии—"

    oliver "Монитор…"
    oliver "Он звучит как таймер."

    hamayumi "Это и есть таймер."
    hamayumi "У тебя будет момент, когда станет легче."
    hamayumi "И ты решишь, что победил."
    hamayumi "Вот тогда ты проиграешь."

    menu:
        "Что делать?"

        "Позвать врача и закрыть это":
            hamayumi "..."
            "Тишина становится слишком удобной."
            "В голове появляется мысль: 'пусть решат за меня'."

        "Остановиться и поверить Хамаюми":
            $ hospital_score += 1
            hamayumi "Тогда ты ещё держишься."
            hamayumi "Поверить — не значит подчиниться."
            hamayumi "Значит признать: часть тебя защищается так, как умеет."

        "Промолчать":
            hamayumi "Понял."
            "Молчание не выбирает сторону."
            "Но молчание — идеальная почва для чужих выводов."

    # -------------------------
    # Экран 4 — Поворот: "лечат" не то
    # -------------------------
    scene hospital_corridor
    with fade

    # маленький "разрыв": больница ведёт себя как система
    "Голос по громкой связи" "Пациент Оливер. Подготовка к процедуре. Палата 12."

    oliver "Процедуре?"
    oliver "Мне никто не говорил…"

    hamayumi "Вот он."
    hamayumi "Момент, где реальность становится сценой."

    show nurse at center
    with dissolve

    nurse "Пойдёмте."
    nurse "Это займёт немного времени."
    nurse "После этого станет проще."

    hamayumi "Слушай формулировки."
    hamayumi "'Проще' — это не 'лучше'."

    oliver "Что за процедура?"

    nurse "Коррекция интерпретации."
    nurse "Чтобы вы перестали придавать значение... лишним конструкциям."

    hamayumi "Слышишь?"
    hamayumi "Они не лечат киберспейс."
    hamayumi "Они лечат твою способность сопротивляться удобному объяснению."

    $ hospital_twist_seen = True

    menu:
        "Идти?"

        "Согласиться. Пусть делают.":
            nurse "Хорошо."
            nurse "Не беспокойтесь."
            hamayumi "Это выбор."
            hamayumi "Просто не твой."

        "Попросить объяснить и записать согласие.":
            $ hospital_score += 1
            nurse "Мы можем объяснить."
            nurse "Но вы уверены, что хотите деталей?"
            hamayumi "Правильный ход."
            hamayumi "Детали возвращают власть."

        "Отказаться и вернуться в палату.":
            nurse "Вы можете отказаться."
            nurse "Но тогда будет сложнее."
            hamayumi "Сложнее — значит: тебе придётся выдерживать себя самому."

    hide nurse
    with dissolve

    # -------------------------
    # Экран 5 — Процедурная / столкновение двух миров
    # -------------------------
    scene hospital_procedure
    with dissolve

    oliver "Здесь холоднее."

    hamayumi "И свет другой."
    hamayumi "Он похож на твой киберспейс."
    hamayumi "Только замаскирован под стерильность."

    "Система" "Нормализация контекста..."
    "Система" "Снижение значимости символических связей..."
    "Система" "Отключение вторичных нарративов..."

    oliver "Это... звучит как ядро."

    hamayumi "Потому что это и есть ядро."
    hamayumi "Только в белом халате."

    menu:
        "Последняя опора"

        "Держаться за якорь: проверять, что реально.":
            $ hospital_score += 1
            oliver "Дата. Место. Имя."
            oliver "Я проверяю, а не угадываю."
            hamayumi "Вот это перепрошивка."
            hamayumi "Не стирание. Настройка."

        "Сдаться и позволить выключить 'лишнее'.":
            "Тепло разливается по голове."
            "Мысли становятся мягкими."
            hamayumi "Вот так и делают 'легко'."
            hamayumi "Когда легко — ты перестаёшь держать форму."

        "Закричать, вырваться, сломать.":
            "Руки дрожат."
            "Свет режет."
            hamayumi "Сопротивление без направления."
            hamayumi "Ты тратишь силы, не удерживая смысл."

    # -------------------------
    # Экран 6 — Итог ветки
    # -------------------------
    scene hospital_room
    with fade

    if hospital_score >= 3:
        $ hospital_done = True
        oliver "Если я перестану давать этому власть — оно ослабнет."
        oliver "Но я не обязан стирать часть себя, чтобы жить."
        hamayumi "Тогда в ядре у тебя останется только реальность."
        hamayumi "Не та, что удобна системе."
        hamayumi "Та, что проверена тобой."
    else:
        $ hospital_done = False
        hamayumi "Ты сомневаешься."
        hamayumi "Значит, связь ещё держится."
        hamayumi "И они будут продолжать предлагать 'проще'."
        "Но ответа ты так и не оформил."

    call ambient_reset
    jump act2_transition
